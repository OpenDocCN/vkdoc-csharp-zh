# 四、世界的构建

现在我们已经学会了如何创建基本的角色动画并改变它们之间的状态，是时候为这些角色创建一个居住的世界了。二维(2D)世界通常是通过将一系列瓷砖放在一起以绘制背景，然后将其他瓷砖放在该背景之上以创建深度幻觉来创建的。这些图块实际上只是被分割或“切片”成方便的尺寸的精灵，通常使用图块调色板来放置。设计者或开发者可以构建这些 Tilemaps 的多个层来创建诸如树、头顶上飞翔的鸟、甚至远处的山之类的效果。在本章中，我们将学习如何做这些事情。你甚至可以为我们的 RPG 游戏创建自己的自定义磁贴地图。您还将学习 Unity 相机如何工作，以及如何创建行为来跟随玩家在关卡中走动。

## 平铺地图和平铺调色板

随着 Tilemap 功能的引入，Unity 在 2D 工作流工具链方面向前迈出了重要的一步。Unity Tilemaps 使得在 Unity 编辑器中创建关卡变得简单，而不是依赖外部工具。Unity 也有许多工具来增强 Tilemap 的特性，其中一些我们将在本章中介绍。

Tilemaps 是以特定排列存储精灵的数据结构。Unity 抽象出了底层数据结构的细节，使得开发人员可以更容易地专注于 Tilemap 的工作。

首先，我们需要导入 Tilemap 资源，就像我们在第 3 章[中导入玩家和敌人的精灵资源一样。](3.html)

在我们开始导入之前，让我们组织一下:在精灵目录中创建新的文件夹，名为:“对象”和“户外”我们将使用这些文件夹来保存 spritesheets 和 sliced sprites，用于我们的室外 Tilemap 和我们将放置在我们的世界中的各种对象。

从下载的图书资源中，在章节 [4](4.html) 文件夹中，找到标题为“OutdoorsGround.png”的 spritesheet。将 spritesheet 拖动到 Sprites ➤户外文件夹中。检查器中的户外导入设置应设定为以下内容:

*   纹理类型:精灵(2D 和用户界面)

*   精灵模式:多重

*   每单位像素:32

*   过滤器模式:点(无过滤器)

*   确保选择底部的默认按钮，并将压缩设置为:无

按下应用按钮。

现在，我们要切割刚刚导入的 spritesheet。在检查器中点击相应的按钮进入精灵编辑器。按左上角的切片按钮，然后从类型菜单中按像元大小选择网格。X 和 Y 像素大小使用 32 × 32。按切片按钮。

检查产生的切片线看起来不错，然后按下精灵编辑器右上角的应用按钮。我们现在有了户外瓷砖套装。

接下来，我们要创建我们的 Tilemap。在层次视图中，右键单击并选择 2D 对象➤ Tilemap 以创建 Tilemap 游戏对象。您应该会看到一个名为“Grid”的游戏对象，以及一个名为“Tilemap”的子游戏对象此网格对象用于配置其子 Tilemaps 的布局。子 Tilemap 由一个像所有游戏对象一样的转换组件、一个 Tilemap 组件和一个 Tilemap Renderer 组件组成。

这个 Tilemap 组件是我们实际“绘制”瓷砖的地方。

## 创建瓷砖调色板

在我们绘画之前，我们需要创建一个瓷砖调色板，它是由单独的瓷砖组成的。转到菜单窗口➤瓷砖调色板显示瓷砖调色板窗格。将“互动程序面板”面板停靠在与检查器相同的区域。

我们希望我们的项目保持有序，所以在我们的项目视图中，在主资产文件夹下创建一个名为“TilePalettes”的文件夹，然后在 Sprites 文件夹下创建另一个名为“Tiles”的文件夹。在图块文件夹中，创建两个名为“户外”和“对象”的文件夹您的项目视图应该类似于图 [4-1](#Fig1) 。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig1_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig1_HTML.jpg)

图 4-1

创建文件夹后的项目视图

在图块调板窗口中选择“创建新调板”按钮。将调色板命名为“Outdoor Tiles”，并保留网格和单元大小设置，如图 [4-2](#Fig2) 所示。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig2_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig2_HTML.jpg)

图 4-2

创建新的拼贴调色板

按“创建”并将图块调色板保存到新创建的图块调色板文件夹中。这将创建一个 TilePalette 游戏对象。

在项目视图中选择“精灵➤户外”文件夹，然后从停靠的位置选择“平铺调色板”视图。我们将使用之前导入并切片的 Outdoors spritesheet 创建一个瓷砖调色板。

选择 Outdoors spritesheet 并将其拖动到 Tile Palette 区域，在那里显示“将 Tile、Sprite 或 Sprite 纹理资源拖动到此处”

当系统提示“将图块生成到文件夹”时，导航到我们之前创建的精灵➤图块➤室外图块文件夹，然后按“选择”按钮。Unity 现在将从单独切片的精灵中生成 TilePalette。过一会儿，您应该会看到我们的户外 spritesheet 中的瓷砖出现在瓷砖面板中。

## 用瓷砖调色板绘画

现在有趣的部分来了:我们将使用我们的 Tile 调色板来绘制 Tilemap。

从拼贴调色板中选择画笔工具，然后从拼贴调色板中选择一个拼贴。使用画笔在场景视图中的 Tilemap 上绘制。如果写错了，可以按住 *Shift* 键，把瓷砖画笔当橡皮擦用。当画笔被选中时，您可以按住 Option (Mac)/Alt (PC) +鼠标左键来平移 Tilemap。

使用 Option (Mac)/Alt (PC) +鼠标左键在图块调色板周围平移，左键单击以选择图块，左键单击并拖动以选择一组图块。如果您的鼠标有滚轮，您可以使用它来放大和缩小图块调板，或者您可以按住 Option / Alt +在触摸板上上下滑动来放大和缩小。这些相同的键和手势也适用于平铺地图。

画你的磁贴地图，玩得开心！你可以让你的磁贴看起来像你喜欢的那样，但是这里有一个如何开始的建议(图 [4-3](#Fig3) )。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig3_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig3_HTML.jpg)

图 4-3

Tilemap 的起源

现在我们已经完成了一点绘画，让我们仔细看看瓷砖调色板中的工具。

### 瓷砖调色板

*   ![img/464283_1_En_4_Chapter/464283_1_En_4_Figa_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Figa_HTML.jpg)选择——选择网格或特定图块的区域

*   ![img/464283_1_En_4_Chapter/464283_1_En_4_Figb_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Figb_HTML.jpg)移动选择——在选定区域内移动

*   ![img/464283_1_En_4_Chapter/464283_1_En_4_Figc_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Figc_HTML.jpg)画笔——从图块调色板中选择一个图块，然后使用画笔在图块地图上绘画

*   ![img/464283_1_En_4_Chapter/464283_1_En_4_Figd_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Figd_HTML.jpg)方框填充——使用当前选中的图块绘制一个填充区域

*   ![img/464283_1_En_4_Chapter/464283_1_En_4_Fige_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fige_HTML.jpg)选择新笔刷——使用 Tilemap 中现有的图块作为新笔刷

*   ![img/464283_1_En_4_Chapter/464283_1_En_4_Figf_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Figf_HTML.jpg)擦除——从磁贴地图中移除一个已绘制的磁贴(快捷键:按住 Shift 键)

*   ![img/464283_1_En_4_Chapter/464283_1_En_4_Figg_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Figg_HTML.jpg)整体填充——用当前选中的图块填充一个区域

让我们回到建立我们的水平。

从你为这本书下载的资源中，将名为“OutdoorsObjects.png”的文件拖到精灵➤对象文件夹中。检查器中的导入设置应设定为以下内容:

*   纹理类型:精灵(2D 和用户界面)

*   精灵模式:多重

*   每单位像素:32

*   过滤器模式:点(无过滤器)

*   确保选择底部的默认按钮，并将压缩设置为:无

按下应用按钮。

现在点击检查器中相应的按钮进入精灵编辑器。按左上角的切片按钮，然后从类型菜单中按单元格大小选择网格。X 和 Y 像素大小使用 32 × 32。我们正在重用我们在第三章学到的精灵切片技术。

按下切片按钮，并检查产生的白色切片线看起来像他们在正确的位置分割精灵表。按下精灵编辑器右上角的应用按钮。我们现在有了一组户外主题的物体精灵来放置在我们的场景中。

现在，我们将创建一个瓷砖调色板来绘制这些对象精灵。返回到我们的图块调色板，并从下拉列表中选择“创建新调色板”。将新的调色板命名为“室外对象”，然后按“创建”按钮。出现提示时，将此调色板保存到 TilePalettes 文件夹中，我们之前在该文件夹中保存了室外瓷砖调色板。

现在，我们将做与我们为室外瓷砖所做的相同的事情:选择室外对象 spritesheet，并将其拖动到瓷砖调色板区域，在那里它说，“拖动瓷砖，精灵或精灵纹理资产在这里。”

当提示“生成瓷砖到文件夹”，导航到我们创建的精灵➤瓷砖➤对象文件夹，并按下选择按钮。Unity 现在将从单独切片的精灵中生成瓷砖调色板瓷砖。过一会儿，您应该会看到我们的对象 spritesheet 中的图块出现在图块调色板中。

### 小费

有时精灵是由多个瓷砖组成的。要一次选择多个单幅图块，请确保选择了画笔工具，然后单击并拖动一个矩形围绕您要使用的单幅图块。然后你就可以正常的用画笔画画了。对象 spritesheet 中的大岩石由四个独立的 sprite tiles 组成。

通过单击并拖动四块瓷砖周围的矩形，从户外对象瓷砖调色板中选择一块岩石。用画笔在你的地图上放置一块石头。您会立即注意到有些地方看起来不对:您实际上可以在岩石精灵的轮廓周围看到 Unity 场景视图的背景(图 [4-4](#Fig4) )。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig4_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig4_HTML.jpg)

图 4-4

放置的岩石对象精灵周围的透明边框

当我们在地板砖上绘制岩石瓷砖时，我们实际上并没有在现有的瓷砖上绘制。相反，我们用新的瓷砖替换了现有的瓷砖。因为我们绘制的岩石精灵包含一些透明像素，所以我们可以看到场景视图的背景。为了避免这种情况，我们将使用多个 Tilemaps 和排序层。

## 使用多个切片地图

让我们把地图整理好。单击层次视图中的 Tilemap 对象，并将其重命名为:“Layer_Ground”

我们将创建多个 Tilemaps，并将它们堆叠在图层中。右键单击层次视图中的网格对象，然后转到:2D 对象➤平铺地图创建一个新的平铺地图。选择这个新的 Tilemap，并将其重命名为:“层 _ 树 _ 和 _ 岩石。”正如你可能已经从名字中猜到的，我们将在这个 Tilemap 上绘制树木、灌木丛、灌木和岩石。

在这一点上，如果你开始绘画，你会注意到又碰到了同样的透明度问题。要解决这个问题，我们必须做两件事。

要在特定的 Tilemap 上绘画，必须在 Tile Palette 视图中选择它作为**活动 Tilemap** 。在 Tile Palette 窗口中，你会注意到活动 Tilemap 的下拉菜单(图 [4-5](#Fig5) )。使用它来选择我们的新层，层 _ 树 _ 和 _ 岩石。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig5_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig5_HTML.jpg)

图 4-5

选择 Layer_Trees_and Rocks 使其成为活动的 Tilemap

如果您还记得我们之前的讨论，精灵渲染器使用排序层来确定渲染精灵的顺序。在我们在 Layer_Trees_and_Rocks Tilemap 上绘制之前，我们需要为 Tilemap 设置排序层。这将确保当我们绘制树木和岩石时，它们会出现在地面瓷砖的顶部。

选择 Layer_Ground 并在检查器中找到 Tilemap 渲染器组件。

按下 Tilemap 渲染器中的添加排序层按钮，创建两个层:将第一个层称为“地面”，将第二个层称为“对象”。通过点击和拖动来重新排列这些排序层，使地面位于列表中的对象之上，如图 [4-6](#Fig6) 所示。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig6_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig6_HTML.jpg)

图 4-6

确保地面层在对象层之上

再次在“层次”视图中选择 Layer_Ground Tilemap，以在检查器中查看其属性。在 Tilemap 渲染器组件中，将排序图层更改为“Ground”选择图层 _Trees_and_Rocks Tilemap，将其排序图层更改为“Objects”

通过将活动层设置为 Layer_Ground 来删除我们之前绘制的岩石瓷砖，然后从瓷砖调色板工具集中选择擦除工具。您也可以通过按住 shift 键并绘画来使用画笔删除项目。用一些草或者任何你喜欢的室外物品面板上的地板砖填充被擦掉的地方。

现在我们准备开始绘画了。当您要绘制地面瓷砖时，请确保活动瓷砖贴图设置为 Layer_Ground，当您要绘制树木、岩石和灌木时，请确保活动瓷砖贴图为 Layer_Trees_and_Rocks。

### 小费

使用方括号键“[”和“]”旋转选定的拼贴，然后再使用它进行绘制。您也可以通过这种方式直接在调色板上旋转图块。

然后将激活的 Tilemap 设置为 Layer_Trees_and_Rocks，并使用 Outdoor Objects Tile 调色板绘制一些岩石和灌木丛(图 [4-7](#Fig7) )。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig7_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig7_HTML.jpg)

图 4-7

在层 _ 树 _ 岩石磁贴上画一些岩石和灌木

现在我们的地图开始看起来像地图了。在我们的玩家开始探索之前，我们还需要做一些事情。

我们要确保玩家呈现在地面和岩石前。我们将通过设置玩家的排序层来实现这一点。选择 PlayerObject，然后在 Sprite 渲染器组件中查找排序层属性，并按“添加排序层”按钮。添加一个名为“字符”的排序层，并将其移动到底部，在地面和物体层之后。现在我们已经告诉 Sprite 渲染器按照从第一个排序层“地面”到最后一个排序层“角色”的顺序渲染对象

你的排序层应该如图 [4-8](#Fig8) 所示。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig8_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig8_HTML.jpg)

图 4-8

添加字符排序层

选择 PlayerObject 并将其排序层设置为我们刚刚创建的 Characters 层。这将使玩家站在地面和地面上的任何物体上，并使角色看起来像是在地面上行走。

我们将在本章后面解释相机是如何工作的，但是现在，选择相机对象并将大小属性更改为 3.75。

按下播放按钮，带我们的玩家在小岛上散步。

您会立即注意到一些事情:

*   镜头不跟着球员。事实上，如果你想的话，你可以直接走出屏幕，一直走下去。

*   玩家可以穿过地图上的物体。

*   您可能会在 Tilemap 上看到一些奇怪的线条或“眼泪”。如果它们出现，它们将位于两块瓷砖之间。

我们将在本章中讨论所有这些问题。

我们将学习使用**碰撞器**来防止玩家走过所有东西，我们将使用一个叫做 **Cinemachine** 的工具来让摄像机跟随玩家行走。我们还要确保摄像机配置正确。我们将配置图形设置，以确保我们得到一个清晰的边缘，这对像素艺术很重要，我们将使用一种材料来消除眼泪。

### 小费

如果您有多个 Tilemap 层，但希望只关注一个层，请使用场景视图右下角的 Tilemap 聚焦模式。这将允许您灰化其他 Tilemap 图层，并专注于特定图层的工作。

## 图形设置

让我们调整 Unity 引擎的图形设置，使我们的像素艺术看起来尽可能好。当当前设备的图形输出不足以将对象的边缘渲染成完美平滑的线条时，Unity 使用一种称为抗锯齿的算法。对象的边缘不是呈现平滑的线条，而是呈现锯齿状或锯齿。抗锯齿算法在对象的边缘上运行，并使其具有平滑的外观，以补偿锯齿状的图形输出。

默认情况下，在 Unity 编辑器中抗锯齿是打开的，与您使用的设备的电源无关。要关闭抗锯齿，请转到编辑菜单➤项目设置➤质量，并将抗锯齿设置为禁用。正如我们所知，Unity 引擎可以用于 3D 和 2D 游戏，但我们不需要为我们的像素艺术风格的 2D 游戏抗锯齿。

从同一个菜单中，编辑➤项目设置➤质量，也禁用各向异性纹理。当使用特定类型的相机透视时，各向异性过滤是增强图像质量的一种方式。它与我们正在做的项目无关，所以我们应该关闭它。

## 照相机

Unity 中的所有 2D 项目都使用一种叫做正交摄像机的东西。正交相机渲染大小相同的远近物体。通过将所有对象渲染成相同的大小，在旁观者看来，好像所有东西离摄像机的距离都是相同的。这与 3D 项目渲染对象的方式不同。在 3D 项目中，对象以不同的大小渲染，以产生距离和透视的错觉。当我们建立一个 2D 项目时，我们在一开始就配置了我们的 Unity 项目使用正交摄像机。

为了在渲染 2D 图形时获得最佳效果，理解相机在 2D 游戏中的工作方式很重要。正交摄像机有一个称为**大小**的属性，它决定了屏幕高度的一半可以容纳多少个垂直的**世界单位**。世界单位通过在 Unity 中设置 **PPU** 或**每单位像素**来确定。正如你可能从名字中怀疑的那样，每单位像素设置描述了 Unity 引擎应该在一个世界单位中渲染多少像素，即每单位像素*。PPU 可以在导入资产过程中设置。PPU 是很重要的，因为当你为你的游戏创作时，你会希望确保所有的东西在同一个 PPU 下看起来都很好。*

摄像机尺寸的计算公式是:

**(垂直分辨率/ PPU) * 0.5 =摄像头尺寸**

让我们用几个简单的例子来阐明这个概念。

给定屏幕分辨率为 960 × 640，垂直屏幕高度为 640 像素。让我们使用 64 的 PPU，使我们的计算简单:640 除以 64 等于 10。这意味着 10 个世界单位相互堆叠将占据整个垂直屏幕高度，5 个世界单位将占据垂直屏幕高度的一半。因此，摄像机尺寸为 5，如图 [4-9](#Fig9) 所示。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig9_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig9_HTML.jpg)

图 4-9

分辨率为 960 × 640，PPU 为 64，因此相机大小为 5

再来做一个例子。如果你的游戏使用 1280 × 1024 的屏幕分辨率，那么垂直屏幕高度就是 1024。使用 32 的 PPU，我们将 1024 除以 32 得到 32。这意味着 32 个世界单位相互堆叠将占据整个垂直屏幕高度，16 个世界单位将占据垂直屏幕高度的一半。因此，正交相机大小为 16。

这里还有最后一个例子来加强这个等式。使用 1280 × 720 的屏幕分辨率，垂直屏幕高度将为 720。使用 32 的 PPU，我们将 720 除以 32 得到 22.5。这意味着 22.5 个世界单位堆叠在一起将适合垂直屏幕高度:22.5 除以 2 等于 11.25，这是屏幕高度和我们的正交相机尺寸的一半。

开始掌握诀窍了吗？正投影尺寸乍一看似乎很奇怪，但实际上，这是一个非常简单的等式。

这又是一个等式:

**(垂直分辨率/ PPU) * 0.5 =摄像头尺寸**

获得好看的像素艺术游戏的诀窍是注意与分辨率相关的正交相机尺寸，并确保艺术作品在某个 PPU 下看起来不错。

在我们的游戏中，我们将使用 1280 × 720 的分辨率，但我们将使用一个技巧来放大图片。我们将 PPU 乘以比例因子 3。

我们修改后的等式将如下所示:

**(垂直分辨率/ (PPU *缩放因子))* 0.5 =摄像机尺寸**

使用 1280 × 720 的分辨率和 32 的 PPU:

(720 / (32 PPU * 3)) * 0.5 = 3.75 摄像头尺寸

这就是为什么我们把相机尺寸提前到 3.75 的原因。

现在我们已经更好地了解了相机在正交游戏中的工作原理，让我们来设置屏幕分辨率。Unity 自带多种屏幕分辨率选择，但有时设置自己的分辨率也是有益的。我们将设置 1280 × 720 的分辨率，这被认为是“标准高清”，应该足以满足我们正在制作的游戏风格。

点击游戏窗口，寻找屏幕分辨率下拉菜单。默认情况下，可能会设置为自由方面，如图 [4-10](#Fig10) 所示。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig10_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig10_HTML.jpg)

图 4-10

下拉菜单

在下拉菜单的底部，按加号打开一个窗口，您可以在其中输入新的分辨率。创建一个 1280 × 720 的自定义分辨率，如图 [4-11](#Fig11) 所示。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig11_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig11_HTML.jpg)

图 4-11

创建新的自定义分辨率

按下播放按钮，让角色在地图上走来走去，看看我们新的分辨率和相机的效果。

令人兴奋的东西！我们的游戏开始变得像...嗯，一个游戏！

我们已经为玩家创建了一个地图，但是你可能已经注意到了，摄像机停留在一个地方。这对于某些类型的游戏来说很好，比如益智游戏，但是对于 RPG 来说，我们需要摄像机跟随玩家。可以编写一个 C# 脚本来引导相机跟随玩家，但我们将使用一个名为 Cinemachine 的 Unity 工具来代替。

### 注意

Cinemachine 最初由亚当·迈希尔创作，在 Unity 资产商店出售。Unity 最终收购了 Cinemachine，并将其作为免费服务的一部分。如第 [2](2.html) 章所述，您可以创建自己的工具、作品和内容，并在 Unity Asset Store 中出售。

## 使用电影胶片

Cinemachine 是一套功能强大的 Unity 工具，用于程序游戏中的摄像机、电影和过场动画。Cinemachine 可以自动执行所有类型的摄像机移动，自动在摄像机之间混合和剪切，并自动执行所有类型的复杂行为，其中许多行为超出了本书的范围。我们将使用 Cinemachine 自动跟踪玩家在地图上的行走。

Cinemachine 通过 Unity 2017.1 的资产商店提供，但从 Unity 2018.1 开始，Cinemachine 通过新的 Unity Package Manager 提供。Unity 的早期版本仍然可以使用资产商店中的 Cinemachine，但该版本不再更新，也不会包含新功能。

稍后我们将讨论如何在 Unity 2017 和 Unity 2018 中安装 Cinemachine。请参阅您正在运行的 Unity 版本的说明。

### 在 Unity 2017 中安装 Cinemachine

转到“窗口”菜单，选择“资产存储”以打开“资产存储”选项卡。在屏幕顶部的搜索栏中，键入“Cinemachine”，然后按 enter 键。您应该会得到类似图 [4-12](#Fig12) 的结果。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig12_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig12_HTML.jpg)

图 4-12

资产商店中的 Cinemachine Unity 套装

点击 Cinemachine 图标，进入资产页面。在“资产”页面上，按“导入”按钮将 Cinemachine Unity 软件包导入到您当前的项目中。Unity 将向您呈现一个弹出屏幕，如图 [4-13](#Fig13) 所示，显示包内的所有资产。按导入按钮。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig13_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig13_HTML.jpg)

图 4-13

导入 Cinemachine Unity 软件包

导入 Cinemachine 包应该已经创建了一个名为“Cinemachine”的新文件夹。

### 在 Unity 2018 中安装 Cinemachine

从菜单中，选择窗口➤软件包管理器。您应该会看到 Unity 软件包管理器窗口出现。选择 All 选项卡，如图 [4-14](#Fig14) 所示，然后选择 Cinemachine。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig14_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig14_HTML.jpg)

图 4-14

选择全部选项卡

点击右上角的安装按钮安装 Cinemachine。Cinemachine 安装完成后，关闭软件包管理器窗口。您应该在项目视图中看到一个新的 Packages 文件夹。

### 安装 Cinemachine 后

不管你运行的是哪个版本的 Unity，当 Cinemachine 安装完成后，你应该会在屏幕顶部看到一个 Cinemachine 菜单，在组件和窗口之间。

### 注意

Unity 包是可以放入项目中的文件集合，开箱即用。软件包以模块化、版本化的形式出现，并自动解析依赖关系。2018 年 5 月，Unity 宣布包是未来，他们打算通过包分发他们的许多新功能。

## 虚拟摄像机

进入 Cinemachine 菜单，选择创建 2D 相机。这应该创建两个对象:一个 **Cinemachine Brain** ，连接到主摄像头，和一个 **Cinemachine** **虚拟摄像头**游戏对象，名为“CM vcam1”。

什么是**虚拟摄像头**？Cinemachine 文档使用了一个很好的类比——虚拟摄像机可以被认为是摄影师。该摄影师控制主摄像机的位置和镜头设置，但实际上不是摄像机。虚拟相机可以被认为是一个轻量级的控制器，它指导主相机并告诉它如何移动。我们可以为虚拟相机设置一个跟随的目标，沿着一条路径移动虚拟相机，从一条路径混合到另一条路径，并围绕这些行为调整所有类型的参数。虚拟摄像机是 Unity 游戏开发工具箱中一个非常强大的工具。

Cinemachine Brain 是场景中主摄像机和虚拟摄像机之间的实际链接。Cinemachine 大脑监控当前活动的虚拟摄像机，然后将其状态应用到主摄像机。在运行时打开和关闭虚拟相机，Cinemachine 大脑可以将相机混合在一起，获得一些非常惊人的结果。

选择虚拟摄像机并将 PlayerObject 拖动到名为“Follow”的属性中，如图 [4-15](#Fig15) 所示。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig15_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig15_HTML.jpg)

图 4-15

将虚拟摄影机跟随目标设置为 PlayerObject

这告诉 Cinemachine 虚拟摄像机在玩家在地图上移动时跟随并跟踪玩家游戏对象的变换组件。

按下播放键，看着摄像机跟着玩家转。相当整洁！有了 Cinemachine，我们只需点击几下鼠标，就可以获得一些非常复杂的相机行为。为了更好地理解控制相机运动的隐藏参数，让我们隐藏地面层。从项目视图中选择 Layer_Ground Tilemap 对象。取消选中 Tilemap 的 Tilemap 渲染器组件旁边的复选框以将其禁用。现在 Unity 不会渲染 Layer_Ground Tilemap 了。你的场景应该类似于图 [4-16](#Fig16) ，隐藏所有的地面瓷砖。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig16_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig16_HTML.jpg)

图 4-16

在取消选中“Tilemap Renderer”左侧的复选框以禁用它之后

现在点击层次视图中的主相机对象，并按下标有背景的彩色框。将背景颜色改为白色(图 [4-17](#Fig17) )。这将使得在下一步中更容易看到 Cinemachine follow 帧。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig17_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig17_HTML.jpg)

图 4-17

将相机背景颜色改为白色

最后，选择虚拟相机，并确保“游戏窗口指南”复选框被选中。下一步你会看到什么是游戏窗口指南。

再次按下播放按钮。请注意，中间有一个白色的盒子围绕着玩家，周围是浅蓝色的区域，还有一个红色的区域包围着它(图 [4-18](#Fig18) )。这个白色的盒子被称为“死区”死区内有一个黄色点，称为跟踪点，它将直接随着玩家移动。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig18_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig18_HTML.jpg)

图 4-18

玩家周围的死区包含一个黄色跟踪点

玩家周围的死区是跟踪点可以移动的区域，摄像头不会移动跟随。当跟踪点移出死区并进入蓝色区域时，摄像机将移动并开始跟踪。Cinemachine 也会给机芯增加一点阻尼。如果你能以某种方式足够快地移动，让球员进入红色区域，摄像机将 1:1 地跟踪球员，没有延迟地跟踪每个动作。

确保游戏视图是可见的，并点击白色框的边缘。将白色框向外拖一点，以调整跟踪区域的大小，使其变大一点。现在，玩家可以在不移动相机的情况下走得更远一点。您可以调整这些引导线的大小，以在游戏中获得自然的相机行为。

在层次视图中 Cinemachine 对象仍处于选中状态的情况下，查看 Cinemachine 虚拟摄影机组件。您将看到一个展开“Body”部分的箭头。在机身部分内，(图 [4-19](#Fig19) )有调整虚拟相机机身 X 和 Y 阻尼的选项。阻尼是虚拟摄像机死区移动以赶上跟踪点的速度。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig19_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig19_HTML.jpg)

图 4-19

虚拟相机机身属性部分的阻尼属性

理解阻尼的最好方法是当你带玩家在地图上走动时调整 X 和 Y 阻尼。按 Play 并试验阻尼值。

如果你把玩家带到地图的边缘，你会看到相机随着目标移动，事情看起来不会太糟。但是我们可以做得更好。

停止播放并在层次视图中选择 Layer_Ground 对象。选中“Tilemap Renderer”左侧的框，使图层再次可见。

### 电影展

现在我们知道了如何让摄像机跟踪玩家走动，我们将学习当玩家接近屏幕边缘时如何防止摄像机移动。我们将使用一个叫做 **Cinemachine Confiner** 的组件来将摄像机限制在某个区域。Cinemachine Confiner 将使用一个碰撞器 2D 对象，我们已经预先配置了它来包围我们想要约束摄像机的区域。

在我们进入实现细节之前，让我们想象一下 Confiner 将如何影响摄像机的移动。请记住，虚拟摄影机实际上是在指挥活动场景摄影机，告诉它向哪里移动以及以什么速度移动。

在图 [4-20](#Fig20) 中，我们有一个场景中的玩家，他正准备向东走。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig20_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig20_HTML.jpg)

图 4-20。玩家正准备向东走

白色区域是当前活动摄影机的可见视口。灰色区域是贴图的其余部分，在摄影机的视口之外，当前不可见。灰色区域的外围被一个 2D 对撞机所包围。

当玩家向东行走时，虚拟相机会引导相机向东移动，并在玩家走过场景时跟踪玩家，如图 [4-21](#Fig21) 所示。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig21_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig21_HTML.jpg)

图 4-21。玩家正在向东走

虚拟相机的移动将考虑玩家的移动速度、死区的大小以及应用于相机机身的阻尼量。

要记住的关键是，我们已经用多边形碰撞器 2D 用灰色圈住了这个区域的周界，并设置了包围器的边界形状指向这个碰撞器。当约束器边缘碰到边界形状的边缘时，它会相互作用并告诉虚拟摄像机引导活动摄像机停止移动，如图 [4-22](#Fig22) 所示。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig22_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig22_HTML.jpg)

图 4-22。碰撞器撞到了 2D 多边形碰撞器的边缘，相机停止了移动

正如你在前面的图中看到的，Confiner 边碰到了包围着关卡的边界图形的边，这个边界图形就是碰撞器 2D。虚拟相机已经停止移动，玩家继续走到地图边缘。

让我们建造一个电影院。

从层级视图中选择我们的虚拟摄像机。在检查器中，在添加扩展旁边，从下拉菜单中选择 CinemachineConfiner。这将为我们的 Cinemachine 2D 摄像机增加一个 Cinemachine Confiner 组件。

CinemachineConfiner 需要一个复合对撞机 2D，或者一个多边形对撞机 2D 来确定限制的边缘从哪里开始。选择 Layer_Ground 对象，并通过“添加组件”按钮添加多边形碰撞器 2D。点击碰撞器组件上的编辑碰撞器按钮，编辑碰撞器，使其包围我们的 Layer_Ground 层的边缘，如图 [4-23](#Fig23) 所示。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig23_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig23_HTML.jpg)

图 4-23

拖动多边形碰撞器 2D 的角以匹配 Layer_Ground 的轮廓

图 [4-23](#Fig23) 中的箭头提醒你在碰撞器和地图边缘之间留一点空间。这是为了让相机显示一点水，而不是严格限制在陆地的边缘。当你完成编辑碰撞器时，不要忘记再次按下编辑碰撞器按钮。检查碰撞器组件的“Is Trigger”属性，然后再次选择我们的 Cinemachine 摄像机。我们想使用这个碰撞器作为触发器，因为如果我们不这样做，当玩家的碰撞器和 Tilemap 碰撞器交互时，玩家将被强行推出碰撞器。这是因为两个带有碰撞器的物体不能占据同一个地方，除非其中一个被用作触发器。

选择并拖动 Layer_Ground 对象到 Cinemachine Confiner 的边界形状 2D 区域，如图 [4-24](#Fig24) 所示。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig24_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig24_HTML.jpg)

图 4-24

来自 Layer_Ground 的多边形碰撞器 2D 将用于 2D 的边界形状

Confiner 将从 Layer_Ground 对象中获取碰撞器 2D，并将其用作 Confiner 的边界形状。确保选中“限制屏幕边缘”框，告诉限制程序停止在多边形 2D 边缘。

按下播放按钮，走到屏幕边缘。如果一切都设置正确，你会看到虚拟相机的死区停止移动，只要相机到达我们之前放置多边形碰撞器 2D 的边缘。图 [4-25](#Fig25) 中的箭头指向多边形碰撞器 2D 的边缘。正如你所看到的，玩家已经走出死区很远，当跟踪点继续随着玩家移动时，摄像机已经停止。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig25_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig25_HTML.jpg)

图 4-25

死区已经停止随着玩家移动

回顾一下，设置 Cinemachine Confiner 的三个步骤:

1.  向虚拟摄像机添加 CinemachineConfiner 扩展。

2.  在 Tilemap 上创建一个多边形碰撞器 2D，编辑其形状以确定限制边，并设置“是触发器”属性。

3.  使用这个多边形碰撞器 2D 作为 Cinemachine Confiner 的边界形状 2D 场。

迫使相机在屏幕边缘停止移动，同时允许玩家继续行走，这是你可能在几十个 2D 游戏中见过的常见效果。

请注意，使用 Confiner 不会阻止玩家离开地图——只是相机会跟踪他们。我们将很快设置一些逻辑来防止玩家离开地图。

## 稳定化

当你带玩家在地图上走动时，你可能会注意到轻微的抖动效果。当你停止行走时，抖动尤其明显，虚拟相机阻尼慢慢使跟踪停止。这种抖动效果是由于过于精确的相机坐标。摄像机正在跟踪玩家，但是它移动到子像素位置，而玩家只是在像素间移动。我们之前在计算正交相机尺寸时已经确定了这一点。

为了解决这种抖动，我们希望强制 Cinemachine 虚拟相机的最终位置保持在像素边界内。我们将编写一个简单的“扩展”组件，并将其添加到 Cinemachine 虚拟摄像机中。我们的扩展组件将抓取 Cinemachine 虚拟相机的最后一个坐标，并将它们四舍五入到与我们的 PPU 一致的值。

创建一个名为 RoundCameraPos 的新 C# 脚本，并在 Visual Studio 中打开它。键入以下脚本，并参考以下注释以更好地理解它。这当然是你将要编写的更高级的脚本之一，但是如果让你的游戏看起来漂亮对你来说很重要，理解它是值得的。

```cs
using UnityEngine;

// 1
using Cinemachine;

// 2
public class RoundCameraPos : CinemachineExtension
{
    // 3
    public float PixelsPerUnit = 32;

    // 4
    protected override void PostPipelineStageCallback(
        CinemachineVirtualCameraBase vcam,
        CinemachineCore.Stage stage, ref CameraState state, float deltaTime) 

    {
        // 5
        if (stage == CinemachineCore.Stage.Body)
        {
            // 6
            Vector3 pos = state.FinalPosition;

            // 7
            Vector3 pos2 = new Vector3(Round(pos.x), Round(pos.y), pos.z);

            // 8
            state.PositionCorrection += pos2 - pos;
        }
    }
    // 9
    float Round(float x)
    {
        return Mathf.Round(x * PixelsPerUnit) / PixelsPerUnit;
    }
}

```

对之前代码的解释是:

```cs
// 1
using Cinemachine;

```

导入 Cinemachine 框架来编写一个扩展组件，我们将把它附加到 Cinemachine 虚拟摄像机上。

```cs
// 2
public class RoundCameraPos : CinemachineExtension

```

挂钩到 Cinemachine 的处理管道的组件必须从 CinemachineExtension 继承

```cs
// 3
public float PixelsPerUnit = 32;

```

每单位像素，或 PPU。正如我们之前讨论相机时所讨论的，我们在一个世界单位中显示 32 个像素。

```cs
// 4
protected override void PostPipelineStageCallback(CinemachineVirtualCameraBase vcam, CinemachineCore.Stage stage, ref CameraState state, float deltaTime)

```

从 CinemachineExtension 继承的所有类都需要此方法。在 Confiner 完成处理后，Cinemachine 会调用它。

```cs
// 5
if (stage == CinemachineCore.Stage.Body)

```

Cinemachine 虚拟摄像机有一个由几个阶段组成的后处理管道。我们执行此检查，以查看我们处于相机后处理的哪个阶段。如果我们在“身体”阶段，那么我们被允许设置虚拟相机在空间中的位置。

```cs
// 6
Vector3 finalPos = state.FinalPosition;

```

检索虚拟摄像机的最终位置

```cs
// 7
Vector3 newPos = new Vector3(Round(finalPos.x), Round(finalPos.y), finalPos.z);

```

调用我们写的 Rounding 方法(如下)对位置进行舍入，然后用结果创建一个新的 Vector。这将是我们新的、像素限定的位置。

```cs
// 8
state.PositionCorrection += newPos - finalPos;

```

将 VC 的新位置设置为旧位置和我们刚刚计算的新舍入位置之间的差值。

```cs
// 9

```

对输入值进行舍入的方法。我们使用这种方法来确保相机总是停留在一个像素位置。

## 材料

当你带着玩家在地图上走的时候，你可能会注意到方块之间的一些线或“裂缝”。这是因为它们没有精确地捕捉到像素级的位置。为了解决这个问题，我们将使用一种叫做材质的东西来告诉 Unity 我们想要如何渲染我们的精灵。

创建一个名为“材料”的新文件夹，然后右键单击并创建➤材料。称这种材料为“Sprite2D”

按如下方式设置材料的属性:

*   着色器:sprite/default

*   确保选中像素捕捉。

新的材料属性应该如图 [4-26](#Fig26) 所示。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig26_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig26_HTML.jpg)

图 4-26

配置新材料

我们希望游戏对象中的渲染器组件使用这种材质，而不是默认材质。

选择我们的 Layer_Ground Tilemap，并通过单击 material 属性旁边的点来更改 Tilemap 渲染器中的材质。当你选择了 Sprite2D 材质后，渲染器组件看起来应该如图 [4-27](#Fig27) 所示。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig27_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig27_HTML.jpg)

图 4-27

在我们的 Tilemap 渲染器组件中使用 Sprite2D 材质

对我们所有的 Tilemap 图层都这样做，然后按下播放按钮，眼泪应该已经消失了。

## 碰撞器和 Tilemaps

### Tilemap 对撞机

现在我们要解决的问题是，玩家可以在 Tilemap 上浏览任何东西。还记得我们在第 3 章中如何给我们的 player 对象添加一个 2D 碰撞器吗？有一个专门为 Tilemap 定制的组件，叫做 Tilemap Collider 2D。当一个 Tilemap 碰撞器 2D 被添加到一个 Tilemap 时，Unity 将自动检测并添加一个碰撞器 2D 到它在那个 Tilemap 上检测到的每个 sprite tile。我们将使用这些 Tilemap 碰撞器来确定 PlayerObject 碰撞器何时与 tile 碰撞器接触，并防止玩家走过它。

从层次视图中选择 Layer_Trees_and_Rocks，然后按检查器中的“添加组件”按钮。搜索并添加一个名为“Tilemap Collider 2D”的组件。

你会注意到 Layers_Objects Tilemap 上的所有精灵现在都有一条绿色细线围绕着它们，表示一个碰撞器组件，类似于图 [4-28](#Fig28) 。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig28_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig28_HTML.jpg)

图 4-28

如箭头所示，2D 在岩石上添加了对撞机

### 注意

如果您在 Tilemap 上看到每个图块周围都有一个框，则您选择了错误的 Tilemap (Layer_Ground)。这是一个常见的错误。点击检查器中组件右上角的齿轮图标，移除 Tilemap Collider 2D 组件，然后从菜单中选择移除组件，如图 [4-29](#Fig29) 所示。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig29_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig29_HTML.jpg)

图 4-29

移除放错位置的 Tilemap 碰撞器 2D 组件

现在在层次视图中选择想要的 Tilemap: Layer_Trees_and_Rocks，并添加一个 Tilemap 碰撞器 2D 组件到其中。

我们刚刚给 Layer_Objects 上的每个贴图精灵添加了一个 2D 碰撞器。看一下图 [4-30](#Fig30) ，注意花园周围的灌木丛是如何拥有七个独立的碰撞器的。问题是 Unity 跟踪所有这些碰撞器的效率很低。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig30_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig30_HTML.jpg)

图 4-30

层 _ 树 _ 岩石中的每个精灵现在都有自己的碰撞器

### 复合对撞机

幸运的是，Unity 附带了一个叫做复合对撞机的工具，它将所有这些独立的对撞机组合成一个大型对撞机，效率更高。在层次视图中保持 Layer_Trees_and_Rocks Tilemap 层处于选中状态，选择“添加组件”并将复合碰撞器 2D 组件添加到 Layer_Trees_and_Rocks。您可以保留所有默认设置。现在检查 2D tile map 碰撞器上的方框，上面写着“由复合材料使用”,看看所有用于布什的独立碰撞器是如何像变魔术一样合并在一起的。

当我们在 Tilemap 层添加一个复合碰撞器 2D 时，Unity 自动添加了一个刚体 2D 组件。设置这个刚体 2D 组件身体类型为静态，因为它不会移动。

在我们按下 Play 之前，我们先确定一下当玩家撞到什么东西的时候，她没有转过来，如图 [4-31](#Fig31) 所示。因为 PlayerObject 有一个动态刚体 2D 组件，所以当它与其他碰撞器交互时，会受到物理引擎施加的力的影响。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig31_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig31_HTML.jpg)

图 4-31

这个看起来荒谬的旋转是由于刚体 2D 碰撞造成的

选择 PlayerObject，在附加的刚体 2D 组件中，勾选“冻结旋转 Z”复选框，如图 [4-32](#Fig32) 所示。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig32_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig32_HTML.jpg)

图 4-32

冻结 Z 轴旋转以防止玩家旋转

按下播放按钮，让玩家在地图上走一圈。你会注意到她再也不能穿过灌木丛，岩石，或者任何你放在树木和岩石层的东西。这是因为我们在第 3 章[中添加到 PlayerObject 的碰撞器与我们刚才添加的 Tilemap 碰撞器发生了碰撞。](3.html)

您还会注意到，对于某些对象，播放器停止的位置和 Tilemap 上的对象之间存在明显的差距。为了更好地查看每个碰撞器的边界，保持游戏运行并通过选择场景选项卡切换到场景视图。

使用鼠标或触摸板上的滚轮放大播放器。如果需要，可以通过按 Alt (PC)或 Option (Mac)键，然后单击并拖动 Tilemap 来平移场景。从层次视图中选择 PlayerObject 以查看其长方体碰撞器。然后按住 Control (PC)或 Cmd / ⌘ (Mac)并选择 Layer_Trees_and_Rocks TileMap，而不取消选择 PlayerObject。

现在两个游戏对象都应该被选中了，你应该在玩家周围看到一个碰撞器，在 Tilemap 中的瓷砖周围看到另一个碰撞器。取决于你如何绘制你的 Tilemap，确切的瓷砖会有所不同，但是正如你在图 [4-33](#Fig33) 中看到的，碰撞器框为每个物体显示为细绿线。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig33_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig33_HTML.jpg)

图 4-33

玩家和她周围的物体之间的距离是由碰撞盒造成的——薄薄的绿色盒子

石头和玩家的碰撞器发生碰撞，阻止玩家靠近。因为碰撞器没有紧紧地拥抱岩石，在玩家停止的地方和岩石之间有一个明显的间隙。我们可以通过编辑每种精灵的物理形状来解决这个问题。

### 编辑物理形状

要编辑 spritesheet 中的 Sprite 的物理形状，请在项目视图中选择 Outdoor Objects spritesheet，并在检查器中打开 Sprite 编辑器。进入左上角的精灵编辑器下拉菜单，选择编辑物理形状，如图 [4-34](#Fig34) 所示。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig34_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig34_HTML.jpg)

图 4-34

在精灵编辑器中选择“编辑物理”形状

选择要编辑的精灵，并按下“轮廓公差”旁边的更新按钮，以查看精灵周围的物理形状轮廓。

拖动方框以匹配您想要的对象轮廓(图 [4-35](#Fig35) )。除非你的游戏机制真的依赖它，否则没有必要对物理形态要求超精确。您可以通过单击线本身来创建其他点，通过选择一个点并按 Control (PC)或 Cmd / ⌘ (Mac) + delete 来删除点。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig35_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig35_HTML.jpg)

图 4-35

将物理形状与精灵相匹配

当你对物理图形感到满意时，按下应用按钮并关闭精灵编辑器。要在场景中使用这个新的物理轮廓，请确保选择了相关的 Tilemap，并从 Tilemap 碰撞器 2D 组件上的齿轮图标下拉菜单中按下重置按钮，如图 [4-36](#Fig36) 所示。这将迫使 Unity 编辑器读取更新的物理形状信息。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig36_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig36_HTML.jpg)

图 4-36

重置 Tilemap 碰撞器 2D 组件以使用新的物理图形

现在按下播放按钮，看看你的新的和改进的碰撞器是如何工作的。

### 小费

Unity 在制作复合碰撞器时，在合并碰撞器方面做出了最好的猜测，因此如果您在 Tile Editor 中调整精灵的物理轮廓时在精灵周围留下了间隙，您可能不会看到所有的 Tile 合并到一个巨大的碰撞器中。您可以再次在平铺编辑器中调整物理轮廓，或者如果没有太多间隙，则保留它。记住:如果你调整物体的物理轮廓，你需要每次重置组件来获得更新的物理轮廓。

因为你现在是碰撞器方面的专家，你可能还想把我们播放器上的箱式碰撞器 2D 调小一点，如图 [4-37](#Fig37) 所示。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig37_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig37_HTML.jpg)

图 4-37

调整我们播放器上的碰撞器大小，使之更适合

现在我们已经熟悉了 Tilemap 碰撞器，让我们用它们在地图上创建一个围绕陆地的边界，这样玩家就不能走进水里了。你的游戏可能有不同的要求——你可能出于某种原因希望玩家走进水里。但接下来是几种不同的技术之一，以防止球员走进你不想让他们进入的区域。

选择您的 Layer_Ground，并从您不想让玩家进入的区域移除任何牌。在我们创建的示例地图中，我们将移除水瓷砖，因为我们不希望玩家走进水中。我们要移除这些瓷砖，因为我们要将它们绘制到不同的图层上。现在创建一个新的 Tilemap 层，名为“层 _ 水”。确保将新图层上的排序图层设置为地面，以保持一致。

确保选择新创建的层作为平铺调色板屏幕中的活动平铺地图。画出你想让玩家远离的区域，比如水，如图 [4-38](#Fig38) 所示。请注意，在图 [4-38](#Fig38) 中，我们将焦点设置为 Tilemap，因此我们只能看到当前所选 Tilemap 层的图块。

![img/464283_1_En_4_Chapter/464283_1_En_4_Fig38_HTML.jpg](img/464283_1_En_4_Chapter/464283_1_En_4_Fig38_HTML.jpg)

图 4-38

打开焦点可以更清楚地看到新的 Tilemap 图层

我们想添加一个 Tilemap 碰撞器 2D 和一个复合碰撞器 2D 到层 _ 水 Tilemap。添加复合碰撞器 2D 将自动添加一个刚体 2D 组件。将刚体 2D 身体类型设置为静态，因为我们不希望海洋瓷砖在与玩家碰撞时移动。最后，在图块碰撞器 2D 中选中“用于合成”框，将所有单独的图块碰撞器合并成一个高效的碰撞器。

按下播放按钮，注意玩家是如何无法再走进水中的。我们在这里用对撞机所做的并不是什么新鲜事。在本章的前面，当我们使用 Tilemap 碰撞器时，你已经做了这种事情。

## 摘要

在这一章中，我们已经介绍了用 Unity 制作 2D 游戏的一些核心概念。我们学习了如何将精灵变成瓷砖调色板，并用它们来绘制瓷砖地图。我们使用碰撞器来防止玩家穿过物体，以及如何调整它们来获得更好的玩家体验。我们学习了如何配置相机，以实现缩放比例、艺术尺寸和分辨率之间的平衡，这在 2D 像素艺术风格的游戏中非常重要。我们在这一章中提到的最有价值的工具之一是 cinema Chine——一个自动化摄像机运动的强大工具。如果你有兴趣了解更多关于 Cinemachine 的信息， [`https://forum.unity.com`](https://forum.unity.com) 是一个提问和向它的创造者学习的好地方！在第五章中，你将会看到我们到目前为止所学的东西汇集在一起，你将会开始觉得你真的在做一个游戏。