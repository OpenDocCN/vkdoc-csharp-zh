# 3.实体框架核心的概念

在这一章中，你将学习实体框架核心的核心概念，根据实体框架核心的过程模型和工件进行分解。

## 实体框架核心的过程模型

实体框架核心支持以下内容:

*   现有数据库的反向工程(从现有数据库模式创建对象模型)
*   数据库的正向工程(从对象模型生成数据库模式)。

如果您已经有了一个数据库，或者开发人员选择以传统方式创建一个数据库，那么逆向工程(通常称为数据库优先)非常有用。第二个选项称为正向工程，它使开发人员能够设计对象模型。由此，开发人员可以生成一个数据库模式。

对于开发人员来说，正向工程通常更好，因为您可以设计编程所需的对象模型。

正向工程可以在开发时(通过所谓的模式迁移)或运行时使用。模式迁移是用初始模式或后来的模式扩展/修改来创建数据库。

在运行时，这意味着当基于实体框架核心的应用程序运行时，数据库被创建(`EnsureCreated()`)或更新(`Migrate()`)。

逆向工程总是发生在开发过程中。

实体框架核心的前身 ADO.NET 实体框架支持四种流程模型，如下所示:

*   逆向工程与 EDMX 文件(又名数据库第一)
*   代码优先的逆向工程
*   用 EDMX 文件进行正向工程(又名模型优先)
*   代码优先的正向工程

因为实体框架核心中没有 EDMX，所以其中两个模型已经被淘汰。实体框架核心中的逆向工程和正向工程是相应的代码优先实践的继承者。然而，微软不再先谈代码，因为这个名字对许多开发人员来说意味着向前工程。微软一般参考基于代码的建模。图 [3-1](#Fig1) 表示正向工程和反向工程。

![A461790_1_En_3_Fig1_HTML.jpg](A461790_1_En_3_Fig1_HTML.jpg)

图 3-1

Forward engineering versus reverse engineering for Entity Framework Core

表 [3-1](#Tab1) 比较了实体框架核心中两种流程模型的特点。

表 3-1

Forward Engineering vs. Reverse Engineering in Entity Framework Core

<colgroup><col align="left"> <col align="left"> <col align="left"></colgroup> 
| 特征 | 逆向工程 | 正向工程 |
| :-- | :-- | :-- |
| 导入现有数据库 | -好的 | 一千 |
| 数据库模式的更改和扩展 | ✖(微软)公司(与第三方工具实体开发商合作) | (迁移) |
| 图形模型 | ✖(微软)公司(与第三方工具实体开发商合作) | ✖(微软)公司(与第三方工具实体开发商合作) |
| 存储过程 | 可通过第三方工具实体开发人员手动使用(微软)映射代码生成 | 可手动使用(微软) |
| 表值函数 | 可通过第三方工具实体开发人员手动使用(微软)映射代码生成 | 可手动使用(微软) |
| 视图 | 可通过第三方工具实体开发人员手动使用(微软)映射代码生成 | 一千 |
| 在对象模型中拥有元数据/注释 | 有可能，但不容易使用第三方工具实体开发人员更容易 | 非常简单！ |
| 对对象设计的控制 | 一千 | -好的 |
| 清楚 | 一千 | -好的 |

## 实体框架核心的组件

图 [3-2](#Fig2) 说明了一个实体框架核心项目的关键组件以及它们与传统数据库对象的关系。

![A461790_1_En_3_Fig2_HTML.jpg](A461790_1_En_3_Fig2_HTML.jpg)

图 3-2

The central artifacts in Entity Framework Core and their context

数据库管理系统(DBMS)包含一个带有表和视图的数据库。

Note

目前只能使用带有主键的表或带有包含主键的视图的表。在 Entity Framework Core 版本 2.1 中，将有读取(但不改变)没有主键的表的选项(参见附录 [C](23.html) )。

实体类(也称为域对象类、业务对象类、数据类或持久类)是表和视图的表示。它们包含映射到表/视图列的属性或字段。实体类可以是普通的旧 CLR 对象(POCO 类)；换句话说，它们不需要基类和接口。但是，您不能仅使用这些对象来访问数据库。

Best Practice

虽然可以使用字段，但是您应该只使用属性，因为许多其他库和框架都需要属性。

上下文类是一个总是从`DbContext`基类派生的类。对于每个实体类，它都有类型为`DbSet<EntityClass>`的属性。上下文类或`DbSet`属性以 LINQ 命令、SQL 命令、存储过程和表值函数(TVF)调用或用于追加、修改和删除的特殊 API 调用的形式获取自创建程序代码的命令。context 类将命令发送给特定于 DBMS 的提供者，后者通过`DbCommand`对象将命令发送给数据库，并从数据库接收`DataReader`中的结果集。上下文类将`DataReader`对象的内容转换成实体类的实例。这个过程叫做物化。