# 12.增加一条新赛道

我们已经从头到尾审查了代码。你已经看到了每一个游戏机制和互动，现在我们要在 Unity 编辑器中建立一个新的轨道，并将其插入到游戏中。这将强化你在代码审查过程中学到的概念，并向你展示`GameObject`在哪里遇到代码。我们将一步一步地进行，将预设的游戏对象添加到场景中，建造一个新的赛道，然后通过将赛道连接到游戏的开始菜单屏幕，最终将赛道添加到游戏中。好了，我们已经有了计划，让我们开始吧！

## 跟踪环境和清理脚本

我们要做的第一件事是创建一个名为“MyTrack15”的新场景并打开它。一旦完成，我们将需要一个地方来放置我们的新赛道。让我们把注意力转向“层次”面板。右键单击面板内部并选择“创建空白”将新的`GameObject`重命名为“特性”再执行两次该操作，并创建以下两个对象:“Menus”和“SceneOther”将默认的`Main Camera`和`Direction Light`游戏对象移动到刚刚创建的`SceneOther`对象中。您的层次结构面板应该在层次结构的根处有以下条目。

![../images/520710_1_En_12_Chapter/520710_1_En_12_Fig1_HTML.jpg](../images/520710_1_En_12_Chapter/520710_1_En_12_Fig1_HTML.jpg)

图 12-1

新赛道层级示例 1 描述新赛道开发过程中场景层级的图像片段

我们将使用这些空的`GameObject`就像文件系统中的文件夹一样。从性能的角度来看，这是非常好的，并且实际上是保持项目的游戏对象有组织的一个很好的方法。为了给赛道设置一个简单的环境，我们将在场景中创建一个现有预设对象的实例。在“项目”面板中，找到“预设”文件夹，并找到名为“板”的条目把它拖到“层级”面板，然后放到“特色”游戏对象中。对名为“毁灭者”的预设重复这个过程您的层次结构应该如下所示。

![../images/520710_1_En_12_Chapter/520710_1_En_12_Fig2_HTML.jpg](../images/520710_1_En_12_Chapter/520710_1_En_12_Fig2_HTML.jpg)

图 12-2

新赛道层级示例 2 添加棋盘和破坏者对象后，描述场景层级的图像片段

我们需要“棋盘”游戏对象稍微宽一点。在层次中选择它，并将检查器中的“缩放 X”值从 1 更改为 1.5。那会让板子更宽一点，让我们的轨道能放进去。您的设置应该如下图所示。游戏对象应该比棋盘大得多，并且位于棋盘下方。

![../images/520710_1_En_12_Chapter/520710_1_En_12_Fig3_HTML.png](../images/520710_1_En_12_Chapter/520710_1_En_12_Fig3_HTML.png)

图 12-3

新赛道场景示例 1 描述棋盘和破坏者游戏对象及其相对位置的屏幕截图

显然，它不必完全匹配，但您的设置应该类似于前面列出的屏幕截图所示。在下一节中，我们将设置赛车和游戏状态对象以及相关的脚本。

## 悬停赛车和游戏状态对象

在本节中，我们将向场景中添加赛车手、游戏状态对象和相关脚本。在我们拥有一条功能齐全的综合赛道之前，我们还需要完成一些步骤，但这将使我们离目标更近一步。我们将从悬停赛车出发。把你的注意力放在“项目”面板上，找到“预设”文件夹。搜索名为“StartingSet”的预设，并将其拖动到“Hierarchy”面板中，使其成为一个根`GameObject`条目，如下图所示。

![../images/520710_1_En_12_Chapter/520710_1_En_12_Fig4_HTML.png](../images/520710_1_En_12_Chapter/520710_1_En_12_Fig4_HTML.png)

图 12-4

新赛道层次示例 3 描述添加 StartingSet 对象后的场景层次的图像片段

执行相同的步骤，除了这一次找到名为“游戏状态”的预设，并将其拖动到层次结构中，使其成为`SceneOther`对象的子对象。下图描述了当前场景层次。在你的层级面板中应该有一个匹配的设置。

![../images/520710_1_En_12_Chapter/520710_1_En_12_Fig5_HTML.jpg](../images/520710_1_En_12_Chapter/520710_1_En_12_Fig5_HTML.jpg)

图 12-5

新赛道层级示例 4 添加 GameState 对象后描述层级的图像片段

我们必须调整`StartingSet`对象的位置。选择它并将“位置 Y”值调整到–66。您可以有稍微不同的定位，因此如果值-66 没有使参赛者靠近棋盘表面，请使用“场景”面板并重新定位他们，以便他们靠近棋盘表面但不接触它。接下来，展开`SceneOther`父对象并选择`Main Camera`子对象。在“检查器”面板中，点按“名称”栏左侧的复选框以停用摄像机。

当我们这样做的时候，让我们为一些我们知道不会移动的场景对象切换静态标志。展开`Features`游戏对象，并将`Board`和`Destroyer`游戏对象设置为静态，如果它们还没有这样配置的话。如果出现提示，将静态标志应用于所有子对象。我们来测试一下场景。单击播放按钮；你应该通过玩家的摄像头看到棋盘。等待几秒钟，你就可以控制赛车了。这类似于您以前使用过的演示场景。当我们完成设置后，会有一个倒计时显示，表明这一时间的流逝。现在，我们只能等待几秒钟。

运行场景后，如果悬停赛车在场景开始时向下浮动，那么它有点太高了。将`StartingSet`向下调整一点，然后再次测试。同样，如果比赛者在场景开始时弹跳到空中，或者落到棋盘表面以下，那么比赛者就有点太低了。将`StartingSet`调高一点，然后再次测试。请记住，当场景演示停止时，在场景运行时所做的场景更改将会丢失。停止场景后进行调整，以便正确存储和保存。在场景运行时进行调整，以便在运行时进行测试。接下来，我们将处理赛道和航路点。

## 轨迹和航路点对象

新跑道开始成形了。我们已经设置了许多`GameObject`和脚本组件。我们可以运行场景，开车四处转转，但事情相当贫瘠。只有一个灰色的大白板，没别的了。让我们在我们的板上添加一个轨迹和航路点。我创建了一个简单的轨道供我们使用。通常情况下，你可以将跑道模型或预设拖到层级上来建立一个跑道。在这种情况下，我已经为你做了工作。

将你的注意力转移到“项目”面板中的“预设”文件夹，并找到“简单轨迹”预设。将预设拖放到层级中，使其成为`Features`游戏对象的子对象。将`SimpleTrack`对象的位置设置为“X”= 35，“Y”= 0，“Z”=-9。你可以对你的板有稍微不同的定位，如果是这样，不要担心，只要移动轨道，使它在板的中心。确保道路是可见的，并且轨迹没有在棋盘表面上盘旋。设置的截图如下。

![../images/520710_1_En_12_Chapter/520710_1_En_12_Fig6_HTML.png](../images/520710_1_En_12_Chapter/520710_1_En_12_Fig6_HTML.png)

图 12-6

新的赛道场景示例 2A 屏幕截图描绘了赛道在棋盘内居中的场景

现在我们有了一条赛道，让我们为这条赛道重新定位悬停赛车到一个好的起点。将`StartingSet`对象的位置设置为" X" = -430，" Y" = -66，" Z" = -254。这应该定位在前面列出的截图中显示的赛车。如果你的对象的位置不同，那么就不要使用这里列出的值。相反，使用 Unity 编辑器重新定位汽车，使其类似于所示的设置。

接下来让我们添加赛道的航点。找到“SimpleWaypoints”预设，并将其拖动到层次结构中，使其成为`Features`游戏对象的直接子对象。如有必要，调整路点的位置，使其与赛道的弯道和直道对齐。调整`StartingSet`的位置，使悬停赛车位于赛道该侧的航路点之间。在我们进入下一部分之前，我还想做最后一件事。

展开`SceneOther`父游戏对象并选择`GameState`子对象。在“检查器”面板中展开“TrackScript”脚本组件条目。将“圈数”字段设置为一个较大的数字；因为这条赛道不是很大，我们会比平时多跑几圈。用八圈之类的。下图描述了场景的当前设置。在你的场景中应该有一些非常相似的东西。

![../images/520710_1_En_12_Chapter/520710_1_En_12_Fig7_HTML.png](../images/520710_1_En_12_Chapter/520710_1_En_12_Fig7_HTML.png)

图 12-7

新的赛道场景示例 3A 屏幕截图描述了配置了板、赛道和航路点以及一组悬停赛车的场景

我应该提到的是，在某些情况下，比赛类型会覆盖您刚刚配置的圈数。如果你查看赛道上的路点列表，你会注意到其中一些会触发帮助通知。一个这样的帮助通知航路点`TrackHelpTurn`，实际上关闭了航迹帮助通知系统，应该是航迹上最后一个这样的航路点。否则，它将过早关闭帮助通知。我还想指出，包含所有悬停赛车的`StartingSet`位于最后一个航路点之后，第一个航路点之前。确保在你的场景中有一个相似的设置。

## 跳转、增强、菜单屏幕等等

在这一节中，我们将为曲目添加一些有趣的功能。我们还会将菜单屏幕添加到曲目中，并将我们的曲目连接到开始菜单。请注意，我们已经能够添加新的特点和功能到轨道，它只是无缝地插入到游戏中。当我们在游戏板上添加了悬浮赛车后，这个场景就可以玩了。如果你回忆一下代码回顾章节，代码被设计成通过关闭一个不能被正确配置的类来对丢失的脚本组件和游戏对象做出反应。这使得我们可以分阶段建造新的赛道，每个阶段结束时都有一个功能场景。请记住，您总是可以在项目的发布版本上注释掉这些检查，以确保最高的性能。

要添加一组新的轨道功能，包括助推、跳跃、趣味框和战斗模式标记，请进入“项目”面板中的“预设”文件夹，找到“简单功能”预设。将条目拖动到层次结构中，使其成为`Features`父游戏对象的子对象。确保新的轨迹对象与轨迹正确对齐，如下图所示。

![../images/520710_1_En_12_Chapter/520710_1_En_12_Fig8_HTML.png](../images/520710_1_En_12_Chapter/520710_1_En_12_Fig8_HTML.png)

图 12-8

新的赛道场景示例 4A 截图描绘了配置了助推、跳跃、趣味框和战斗模式标记的赛道

我们将对下面的预设、`BgMusic`和`BlimpCamera`做同样的事情，除了我们将它们拖放到`SceneOther`父对象中，这样它们就是`SceneOther`父游戏对象的直接子对象。将这些对象添加到场景中会为场景启用背景音乐和飞艇摄像机功能。接下来，我们将添加菜单系统，并配置代码从开始菜单运行您的曲目。为了设置菜单系统，我们需要将以下预设对象拖放到场景层次中的`Menus`父游戏对象中:

*   GameExitMenu

*   游戏帮助菜单

*   GameHUD

*   GameOverMenu

*   GamePauseMenu

*   游戏开始菜单

我们需要一个`EventSystem`对象来让 UI/菜单系统正常运行。右键点击`Menus`父游戏对象，选择“UI”选项，然后选择`EventSystem`条目。你应该有一个`EventSystem`游戏对象作为父菜单的子菜单，以及所有支持的菜单屏幕。您应该有一个类似于下面截图的设置。

![../images/520710_1_En_12_Chapter/520710_1_En_12_Fig9_HTML.jpg](../images/520710_1_En_12_Chapter/520710_1_En_12_Fig9_HTML.jpg)

图 12-9

新赛道层级示例 5 描述配置菜单系统后场景层级的图像片段

花点时间想想我们迄今为止为让赛道恢复运行做了些什么。我们主要使用预置，但这只是为了节省时间，减少启动和运行所需的步骤。发展的阶段是相同的；它们只是为了加快我们的速度而压缩的。我们需要做的最后一件事是将我们的新曲目插入菜单系统代码，这样我们就可以将它作为游戏的一部分，然后进行测试。

![../images/520710_1_En_12_Chapter/520710_1_En_12_Fig10_HTML.png](../images/520710_1_En_12_Chapter/520710_1_En_12_Fig10_HTML.png)

图 12-10

新赛道场景示例 5A 描述配置了菜单系统的场景的当前状态的屏幕截图

要将我们的新赛道连接到游戏，打开`GameStartMenu`和`GameOverMenu`类进行编辑。更改每个类中的`TRACK_NAME_4`类字段，并用你正在处理的场景名称替换列出的场景名称。如果你严格遵守文本，那么这个名字应该是“MyTrack15”我们还需要将场景添加到项目构建配置中。为此，请从以下菜单位置打开构建设置:“文件”➤“构建设置”在结果窗口的顶部是项目构建过程中包含的场景列表。确保“MyTrack15”场景已打开，然后单击“添加打开的场景”按钮。如果需要，可以在列表中上下拖动场景条目来重新定位它。

![../images/520710_1_En_12_Chapter/520710_1_En_12_Fig11_HTML.png](../images/520710_1_En_12_Chapter/520710_1_En_12_Fig11_HTML.png)

图 12-11

新赛道构建设置示例描述项目构建设置中包含的场景列表的屏幕截图

为了比较和调试的目的，可以使用“开始”菜单上的“赛道 3”按钮来访问这个赛道的演示版本。恭喜你！您已经成功地在游戏中添加了一条新赛道！

## 第二章结论

这就引出了本章的结论。我们看到了如何在 Unity 编辑器中使用预设对象来加速赛道的创建。预设允许我们使用预先配置的对象作为构建模块，大大减少了开发时间。请注意，我们已经详细讨论过的所有不同脚本都与正确的游戏对象相关联，当我们将它们拖放到场景的层次结构中时，它们可以插入到我们的核心游戏代码中。

这是通过设计实现的。我们已经回顾过的所有方法转义代码，我们已经多次提到这个短语，用于关闭代码库中未使用或配置不当的类，以在整个赛道开发过程中尽可能保持游戏的功能。让我们回顾一下创建新赛道的步骤。

轨迹环境和清理脚本:在轨迹开发的这个阶段，我们为轨迹创建了一个简单的位置。我们还添加了一个销毁器脚本来处理删除不小心从板上掉下来的对象。你自己试试。如果你在触发一个助推调节器后击中一个跳跃，你可以设法飞离棋盘。看看你做的时候会发生什么。

Hover Racers 和 GameState 对象:赛道开发过程的这一部分将 hover racers 的初始集合添加到棋盘上，并创建了游戏大脑的一个实例，即带有关联的`GameState`脚本组件的`GameState`对象。在赛道开发的这一点上，你将能够演示冲浪板并在场景中驾驶。

轨迹和航路点对象:添加轨迹和航路点对象会打开正在开发的轨迹上的许多功能。人工智能的对手现在开始在赛道上比赛，并且像偏离赛道，错误的方式和卡住的赛车支持这样的功能现在已经启用。

跳跃、助推、菜单屏幕等等:如果没有一些跳跃和其他酷的方面，悬浮车赛道有什么好的？在赛道开发的这一阶段，我们通过在赛道上添加背景音乐、飞艇摄像机、游戏菜单屏幕以及许多助推、跳跃、趣味框和战斗模式标记来完成事情。最后，我们通过在菜单系统中注册来连接赛道和比赛。

花点时间思考一下我们刚刚完成的曲目创建流程。浏览不同的游戏对象，看看有哪些脚本在使用。回想一下我们对这些脚本的审查，并尝试将您在赛道上比赛时看到的功能与驱动它的代码联系起来。